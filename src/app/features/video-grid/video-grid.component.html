<!-- src/app/features/video-grid/video-grid.component.html -->

<!-- Hero Section -->
<section class="video-hero">
  <div class="hero-content">
    <h1>أفلامي - My Films</h1>
    <p>مجموعة من أفلامي الوثائقية والتعليمية</p>
    <p class="subtitle">A collection of my documentary and educational films</p>
  </div>
</section>

<!-- Main Container -->
<div class="video-container">
  <!-- Filter Bar -->
  <div class="filter-bar">
    <button
      class="filter-btn"
      [class.active]="activeCategory() === null"
      (click)="setFilter(null)">
      All Categories - كل الفئات
    </button>

    @for (category of allCategories(); track category.id) {
      <button
        class="filter-btn"
        [class.active]="activeCategory() === category.id"
        (click)="setFilter(category.id)">
        {{ category.categories_ar }} - {{ category.categories_en }}
      </button>
    }
  </div>

  @if (loading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>جاري تحميل الأفلام...</p>
    </div>
  } @else if (filteredVideos().length === 0) {
    <div class="empty-state">
      <i class="fas fa-video"></i>
      <p>لا توجد أفلام في هذه الفئة</p>
    </div>
  } @else {
    <!-- Video Grid -->
    <div class="videos-grid">
      @for (video of filteredVideos(); track video.id) {
        <div class="video-card" (click)="openVideo(video)">
          <!-- Thumbnail -->
          <div class="thumbnail-wrapper">
            <img alt=""
              [src]="video.thumbnail"
              [alt]="video.title"
              class="thumbnail"
              loading="lazy"
              (error)="onImageError($event, video)">
            <div class="play-button">
              <i class="fas fa-play"></i>
            </div>
            <div class="overlay"></div>

            <!-- Category Badge -->
            @if (video.videos_categories) {
              <div class="category-badge">
                {{ video.videos_categories.categories_ar }}
              </div>
            }
          </div>

          <!-- Video Info -->
          <div class="video-info">
            <h3>{{ video.title }}</h3>
            @if (video.title_en) {
              <p class="title-en">{{ video.title_en }}</p>
            }
            <div class="watch-button">
              <span>شاهد الآن</span>
              <i class="fas fa-arrow-left"></i>
            </div>
          </div>
        </div>
      }
    </div>
  }
</div>

<!-- Video Modal -->
@if (selectedVideo(); as video) {
  <div class="video-modal">
    <!-- Backdrop -->
    <div class="modal-backdrop" (click)="closeVideo()"></div>

    <!-- Modal Content -->
    <div class="modal-content">
      <!-- Header -->
      <div class="modal-header">
        <div class="modal-title-section">
          <h2>{{ video.title }}</h2>
          @if (video.title_en) {
            <p class="subtitle">{{ video.title_en }}</p>
          }
        </div>
        <button class="close-btn" (click)="closeVideo()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <!-- Video Player -->
      <div class="video-player">
        <iframe
          [src]="getSafeEmbedUrl(video.url)"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
          [title]="video.title">
        </iframe>
      </div>

      <!-- Category Info -->
      @if (video.videos_categories) {
        <div class="modal-category">
          <span class="category-label">الفئة:</span>
          <span class="category-value">
            {{ video.videos_categories.categories_ar }} - {{ video.videos_categories.categories_en }}
          </span>
        </div>
      }
    </div>
  </div>
}
